<template>
<h2 class="position-sticky z-index-1 top-0 bottom-m text-center bg-color-primary border-primary-m mb-0">
  <div class="container d-flex align-items-center">
    <a href="#" class="position-absolute d-block" @click.prevent="$openTipModal('rapidTest')">
      <img src="@/assets/image/icons/weather-icons/燈泡.png" alt="功能提示的燈泡圖片" height="35">
    </a>
    <a href="#" class="d-block mx-auto w-100 p-2" @click.prevent="$goToPosition('rapidTest')">
      <span class="h2">快篩剩餘數量查詢</span>
    </a>
  </div>
</h2>
<header class="border-bottom text-center py-3 px-2 mb-3" id="rapidTest">
  <h4 class="bg-gary mb-4 p-2">可購買的身份證尾數：<span class="text-danger fs-3 fw-bold">{{canBuyRapidTestId}}</span></h4>
  <label for="countySelector" class="h3">選擇縣市：</label>
  <select name="" id="countySelector" class="bg-color-primary mb-4" @change="getRapidTestData('county',$event)" ref="countySelector">
    <option value="請選擇縣市" disabled selected>請選擇縣市</option>
    <option :value="county" v-for="(area, county) in countyPharmacyNameData" :key="county">{{ county }}</option>
  </select>
  <br />
  <label for="areaSelector" class="h3">選擇地區：</label>
  <select name="" id="areaSelector" class="areaSelect bg-color-primary mb-4" @change="getRapidTestData('area',$event)" ref="areaSelector">
    <option value="請選擇地區" disabled selected>請選擇地區</option>
    <option :value="areaName" v-for="(areaName,index) in areaName" :key="index">{{ areaName }}</option>
  </select>
  <br />
  <label for="search" class="h3">請輸入片段地址</label>
  <br>
  <input type="search" class="bg-color-primary mb-3" id="search" placeholder="例：台北、板橋、五股" v-model.trim="searchText">
  <button type="button" class="bg-color-primary-m text-color-primary" @click="getRapidTestData('search',$event)" v-if="searchText">查詢</button>
  <small class="d-block mb-2">更新頻率: 每1~2分鐘更新一次</small>
  <i class="d-block text-danger mb-2">注意！請查看更新時間是否為最新！</i>
</header>
<div class="mb-10 container-lg">
  <h2 class="text-center text-danger fw-bold" v-if="countyName && rapidTestData.length === 0">查無資料或已全部售完</h2>
  <section class="card mb-3 border shadowStyle" v-for="(pharmacyInfo, index) in rapidTestData" :key="pharmacyInfo" :class="{'bg-gary': index%2 ===0}">
    <div class="card-body hover-color">
      <h5 class="card-title d-flex">{{ pharmacyInfo[1] }} <span class="text-danger fw-bold ms-3">[ 剩餘: {{ pharmacyInfo[7] }} ]</span></h5>
      <p class="text-muted ms-auto">更新時間：<time class="text-muted">{{ pharmacyInfo[8] }}</time></p>
      <address class="card-subtitle text-muted d-flex mb-2">
        <a :href="`tel:+${pharmacyInfo[5]}`">{{ pharmacyInfo[5] }}</a>
      </address>
      <address>
        <p class="card-text">{{ pharmacyInfo[2] }}</p>
      </address>
      <p class="card-text">{{ pharmacyInfo[6] }}
        <br />
        <span class="text-danger fw-bold">剩餘：{{ pharmacyInfo[7] }}</span>
      </p>
      <p class="card-text">備註：{{ pharmacyInfo[9] }}</p>
    </div>
  </section>
</div>
<a href="#" class="position-sticky z-index-2 left-1 bottom-1" @click.prevent="$goToPosition('rapidTest')" :class="{'d-none': topScrollBtnHide}">
  <img src="@/assets/image/icons/rapidTest-icons/向上.png" alt="箭頭向上的圖片" height="50">
</a>
<TipModal />
<IsLoading v-model:active="isLoading">
  <div class="cssload-battery">
    <div class="cssload-liquid"></div>
  </div>
</IsLoading>
</template>

<script>
import TipModal from '@/components/weather/modal/TipModal.vue'
import emitter from '@/methods/emitter.js'
export default {
  components: {
    TipModal
  },

  provide () {
    return {
      emitter
    }
  },

  data () {
    return {
      apiPath: '',
      rapidTestData: [],
      rapidTestTempData: [],
      countyName: '',
      areaName: [],
      canBuyRapidTestId: '',
      searchText: '',
      topScrollBtnHide: true,
      isLoading: false,
      countyPharmacyNameData: {},
      countyPharmacyNameNoSortData: [
        { 臺北市: '士林區' },
        { 臺北市: '大同區' },
        { 臺北市: '大同區' },
        { 臺北市: '大同區' },
        { 臺北市: '大安區' },
        { 臺北市: '大安區' },
        { 臺北市: '大安區' },
        { 臺北市: '中山區' },
        { 臺北市: '中山區' },
        { 臺北市: '中山區' },
        { 臺北市: '中山區' },
        { 臺北市: '中山區' },
        { 臺北市: '中山區' },
        { 臺北市: '中山區' },
        { 臺北市: '中山區' },
        { 臺北市: '中正區' },
        { 臺北市: '中正區' },
        { 臺北市: '內湖區' },
        { 臺北市: '內湖區' },
        { 臺北市: '內湖區' },
        { 臺北市: '內湖區' },
        { 臺北市: '內湖區' },
        { 臺北市: '內湖區' },
        { 臺北市: '文山區' },
        { 臺北市: '北投區' },
        { 臺北市: '北投區' },
        { 臺北市: '北投區' },
        { 臺北市: '松山區' },
        { 臺北市: '松山區' },
        { 臺北市: '松山區' },
        { 臺北市: '松山區' },
        { 臺北市: '松山區' },
        { 臺北市: '松山區' },
        { 臺北市: '信義區' },
        { 臺北市: '信義區' },
        { 臺北市: '信義區' },
        { 臺北市: '信義區' },
        { 臺北市: '信義區' },
        { 臺北市: '信義區' },
        { 臺北市: '南港區' },
        { 臺北市: '南港區' },
        { 臺北市: '南港區' },
        { 臺北市: '萬華區' },
        { 基隆市: '七堵區' },
        { 基隆市: '七堵區' },
        { 基隆市: '中山區' },
        { 基隆市: '中正區' },
        { 基隆市: '安樂區' },
        { 基隆市: '暖暖區' },
        { 新北市: '八里區' },
        { 新北市: '三芝區' },
        { 新北市: '三芝區' },
        { 新北市: '三重區' },
        { 新北市: '三重區' },
        { 新北市: '三重區' },
        { 新北市: '三重區' },
        { 新北市: '三重區' },
        { 新北市: '三重區' },
        { 新北市: '三重區' },
        { 新北市: '三重區' },
        { 新北市: '三重區' },
        { 新北市: '三峽區' },
        { 新北市: '三峽區' },
        { 新北市: '三峽區' },
        { 新北市: '三峽區' },
        { 新北市: '土城區' },
        { 新北市: '土城區' },
        { 新北市: '土城區' },
        { 新北市: '土城區' },
        { 新北市: '土城區' },
        { 新北市: '土城區' },
        { 新北市: '中和區' },
        { 新北市: '中和區' },
        { 新北市: '中和區' },
        { 新北市: '中和區' },
        { 新北市: '中和區' },
        { 新北市: '中和區' },
        { 新北市: '中和區' },
        { 新北市: '中和區' },
        { 新北市: '五股區' },
        { 新北市: '五股區' },
        { 新北市: '平溪區' },
        { 新北市: '永和區' },
        { 新北市: '永和區' },
        { 新北市: '永和區' },
        { 新北市: '永和區' },
        { 新北市: '永和區' },
        { 新北市: '石碇區' },
        { 新北市: '汐止區' },
        { 新北市: '汐止區' },
        { 新北市: '汐止區' },
        { 新北市: '汐止區' },
        { 新北市: '汐止區' },
        { 新北市: '汐止區' },
        { 新北市: '坪林區' },
        { 新北市: '板橋區' },
        { 新北市: '板橋區' },
        { 新北市: '板橋區' },
        { 新北市: '板橋區' },
        { 新北市: '板橋區' },
        { 新北市: '板橋區' },
        { 新北市: '板橋區' },
        { 新北市: '板橋區' },
        { 新北市: '林口區' },
        { 新北市: '林口區' },
        { 新北市: '林口區' },
        { 新北市: '林口區' },
        { 新北市: '林口區' },
        { 新北市: '林口區' },
        { 新北市: '金山區' },
        { 新北市: '泰山區' },
        { 新北市: '泰山區' },
        { 新北市: '泰山區' },
        { 新北市: '泰山區' },
        { 新北市: '泰山區' },
        { 新北市: '泰山區' },
        { 新北市: '烏來區' },
        { 新北市: '貢寮區' },
        { 新北市: '淡水區' },
        { 新北市: '淡水區' },
        { 新北市: '淡水區' },
        { 新北市: '淡水區' },
        { 新北市: '淡水區' },
        { 新北市: '淡水區' },
        { 新北市: '淡水區' },
        { 新北市: '淡水區' },
        { 新北市: '深坑區' },
        { 新北市: '深坑區' },
        { 新北市: '新店區' },
        { 新北市: '新店區' },
        { 新北市: '新店區' },
        { 新北市: '新店區' },
        { 新北市: '新店區' },
        { 新北市: '新店區' },
        { 新北市: '新店區' },
        { 新北市: '新店區' },
        { 新北市: '新莊區' },
        { 新北市: '新莊區' },
        { 新北市: '新莊區' },
        { 新北市: '新莊區' },
        { 新北市: '新莊區' },
        { 新北市: '新莊區' },
        { 新北市: '新莊區' },
        { 新北市: '新莊區' },
        { 新北市: '瑞芳區' },
        { 新北市: '萬里區' },
        { 新北市: '樹林區' },
        { 新北市: '樹林區' },
        { 新北市: '樹林區' },
        { 新北市: '雙溪區' },
        { 新北市: '蘆洲區' },
        { 新北市: '蘆洲區' },
        { 新北市: '蘆洲區' },
        { 新北市: '蘆洲區' },
        { 新北市: '蘆洲區' },
        { 新北市: '鶯歌區' },
        { 新北市: '鶯歌區' },
        { 宜蘭縣: '五結鄉' },
        { 宜蘭縣: '冬山鄉' },
        { 宜蘭縣: '宜蘭市' },
        { 宜蘭縣: '宜蘭市' },
        { 宜蘭縣: '礁溪鄉' },
        { 宜蘭縣: '羅東鎮' },
        { 宜蘭縣: '羅東鎮' },
        { 宜蘭縣: '蘇澳鎮' },
        { 金門縣: '金城鎮' },
        { 金門縣: '金湖鎮' },
        { 桃園市: '八德區' },
        { 桃園市: '八德區' },
        { 桃園市: '八德區' },
        { 桃園市: '大園區' },
        { 桃園市: '大溪區' },
        { 桃園市: '中壢區' },
        { 桃園市: '中壢區' },
        { 桃園市: '中壢區' },
        { 桃園市: '中壢區' },
        { 桃園市: '中壢區' },
        { 桃園市: '中壢區' },
        { 桃園市: '中壢區' },
        { 桃園市: '平鎮區' },
        { 桃園市: '桃園區' },
        { 桃園市: '桃園區' },
        { 桃園市: '桃園區' },
        { 桃園市: '桃園區' },
        { 桃園市: '桃園區' },
        { 桃園市: '桃園區' },
        { 桃園市: '龍潭區' },
        { 桃園市: '龍潭區' },
        { 桃園市: '龍潭區' },
        { 桃園市: '龜山區' },
        { 桃園市: '龜山區' },
        { 桃園市: '龜山區' },
        { 桃園市: '龜山區' },
        { 桃園市: '蘆竹區' },
        { 桃園市: '蘆竹區' },
        { 新竹市: '北區' },
        { 新竹市: '北區' },
        { 新竹市: '北區' },
        { 新竹市: '北區' },
        { 新竹市: '北區' },
        { 新竹市: '東區' },
        { 新竹市: '東區' },
        { 新竹市: '東區' },
        { 新竹市: '東區' },
        { 新竹市: '東區' },
        { 新竹市: '東區' },
        { 新竹市: '東區' },
        { 新竹市: '東區' },
        { 新竹縣: '竹北市' },
        { 新竹縣: '竹北市' },
        { 新竹縣: '竹北市' },
        { 新竹縣: '竹北市' },
        { 新竹縣: '竹北市' },
        { 新竹縣: '竹東鎮' },
        { 新竹縣: '竹東鎮' },
        { 新竹縣: '湖口鄉' },
        { 新竹縣: '新豐鄉' },
        { 新竹縣: '新豐鄉' },
        { 新竹縣: '橫山鄉' },
        { 新竹縣: '橫山鄉' },
        { 苗栗縣: '三義鄉' },
        { 苗栗縣: '公館鄉' },
        { 苗栗縣: '竹南鎮' },
        { 苗栗縣: '竹南鎮' },
        { 苗栗縣: '後龍鎮' },
        { 苗栗縣: '後龍鎮' },
        { 苗栗縣: '苑裡鎮' },
        { 苗栗縣: '苗栗市' },
        { 苗栗縣: '苗栗市' },
        { 苗栗縣: '苗栗市' },
        { 苗栗縣: '泰安鄉' },
        { 苗栗縣: '通霄鎮' },
        { 苗栗縣: '頭份市' },
        { 苗栗縣: '頭屋鄉' },
        { 臺中市: '大甲區' },
        { 臺中市: '大里區' },
        { 臺中市: '大里區' },
        { 臺中市: '大里區' },
        { 臺中市: '大里區' },
        { 臺中市: '大雅區' },
        { 臺中市: '太平區' },
        { 臺中市: '太平區' },
        { 臺中市: '北屯區' },
        { 臺中市: '北屯區' },
        { 臺中市: '北區' },
        { 臺中市: '北區' },
        { 臺中市: '北區' },
        { 臺中市: '北區' },
        { 臺中市: '北區' },
        { 臺中市: '北區' },
        { 臺中市: '北區' },
        { 臺中市: '北區' },
        { 臺中市: '西屯區' },
        { 臺中市: '西屯區' },
        { 臺中市: '西屯區' },
        { 臺中市: '西屯區' },
        { 臺中市: '西屯區' },
        { 臺中市: '西區' },
        { 臺中市: '西區' },
        { 臺中市: '西區' },
        { 臺中市: '西區' },
        { 臺中市: '西區' },
        { 臺中市: '西區' },
        { 臺中市: '沙鹿區' },
        { 臺中市: '沙鹿區' },
        { 臺中市: '沙鹿區' },
        { 臺中市: '東區' },
        { 臺中市: '東勢區' },
        { 臺中市: '東勢區' },
        { 臺中市: '南屯區' },
        { 臺中市: '南屯區' },
        { 臺中市: '南屯區' },
        { 臺中市: '南屯區' },
        { 臺中市: '南屯區' },
        { 臺中市: '南屯區' },
        { 臺中市: '南屯區' },
        { 臺中市: '南屯區' },
        { 臺中市: '南屯區' },
        { 臺中市: '南區' },
        { 臺中市: '南區' },
        { 臺中市: '烏日區' },
        { 臺中市: '清水區' },
        { 臺中市: '清水區' },
        { 臺中市: '清水區' },
        { 臺中市: '清水區' },
        { 臺中市: '潭子區' },
        { 臺中市: '潭子區' },
        { 臺中市: '豐原區' },
        { 臺中市: '豐原區' },
        { 臺中市: '豐原區' },
        { 彰化縣: '二林鎮' },
        { 彰化縣: '二林鎮' },
        { 彰化縣: '大村鄉' },
        { 彰化縣: '大村鄉' },
        { 彰化縣: '北斗鎮' },
        { 彰化縣: '和美鎮' },
        { 彰化縣: '和美鎮' },
        { 彰化縣: '社頭鄉' },
        { 彰化縣: '花壇鄉' },
        { 彰化縣: '花壇鄉' },
        { 彰化縣: '員林市' },
        { 彰化縣: '員林市' },
        { 彰化縣: '員林市' },
        { 彰化縣: '鹿港鎮' },
        { 彰化縣: '鹿港鎮' },
        { 彰化縣: '溪湖鎮' },
        { 彰化縣: '溪湖鎮' },
        { 彰化縣: '彰化市' },
        { 彰化縣: '彰化市' },
        { 彰化縣: '彰化市' },
        { 彰化縣: '彰化市' },
        { 彰化縣: '彰化市' },
        { 彰化縣: '彰化市' },
        { 彰化縣: '福興鄉' },
        { 彰化縣: '福興鄉' },
        { 南投縣: '仁愛鄉' },
        { 南投縣: '水里鄉' },
        { 南投縣: '名間鄉' },
        { 南投縣: '竹山鎮' },
        { 南投縣: '信義鄉' },
        { 南投縣: '南投市' },
        { 南投縣: '南投市' },
        { 南投縣: '埔里鎮' },
        { 南投縣: '埔里鎮' },
        { 南投縣: '草屯鎮' },
        { 南投縣: '國姓鄉' },
        { 南投縣: '集集鎮' },
        { 雲林縣: '斗六市' },
        { 雲林縣: '斗南鎮' },
        { 雲林縣: '斗南鎮' },
        { 雲林縣: '北港鎮' },
        { 雲林縣: '西螺鎮' },
        { 雲林縣: '西螺鎮' },
        { 雲林縣: '虎尾鎮' },
        { 雲林縣: '虎尾鎮' },
        { 雲林縣: '麥寮鄉' },
        { 嘉義市: '西區' },
        { 嘉義市: '西區' },
        { 嘉義市: '東區' },
        { 嘉義市: '東區' },
        { 嘉義縣: '中埔鄉' },
        { 嘉義縣: '太保市' },
        { 嘉義縣: '太保市' },
        { 嘉義縣: '民雄鄉' },
        { 嘉義縣: '朴子市' },
        { 嘉義縣: '朴子市' },
        { 嘉義縣: '竹崎鄉' },
        { 嘉義縣: '新港鄉' },
        { 臺南市: '中西區' },
        { 臺南市: '中西區' },
        { 臺南市: '中西區' },
        { 臺南市: '仁德區' },
        { 臺南市: '仁德區' },
        { 臺南市: '仁德區' },
        { 臺南市: '六甲區' },
        { 臺南市: '六甲區' },
        { 臺南市: '北門區' },
        { 臺南市: '北區' },
        { 臺南市: '北區' },
        { 臺南市: '北區' },
        { 臺南市: '北區' },
        { 臺南市: '永康區' },
        { 臺南市: '永康區' },
        { 臺南市: '永康區' },
        { 臺南市: '永康區' },
        { 臺南市: '永康區' },
        { 臺南市: '玉井區' },
        { 臺南市: '白河區' },
        { 臺南市: '安平區' },
        { 臺南市: '安平區' },
        { 臺南市: '安定區' },
        { 臺南市: '安南區' },
        { 臺南市: '安南區' },
        { 臺南市: '安南區' },
        { 臺南市: '西港區' },
        { 臺南市: '佳里區' },
        { 臺南市: '佳里區' },
        { 臺南市: '東區' },
        { 臺南市: '東區' },
        { 臺南市: '東區' },
        { 臺南市: '東區' },
        { 臺南市: '南區' },
        { 臺南市: '南區' },
        { 臺南市: '柳營區' },
        { 臺南市: '將軍區' },
        { 臺南市: '麻豆區' },
        { 臺南市: '善化區' },
        { 臺南市: '善化區' },
        { 臺南市: '新化區' },
        { 臺南市: '新市區' },
        { 臺南市: '新營區' },
        { 臺南市: '新營區' },
        { 臺南市: '新營區' },
        { 臺南市: '新營區' },
        { 臺南市: '歸仁區' },
        { 臺南市: '歸仁區' },
        { 高雄市: '三民區' },
        { 高雄市: '三民區' },
        { 高雄市: '三民區' },
        { 高雄市: '三民區' },
        { 高雄市: '三民區' },
        { 高雄市: '三民區' },
        { 高雄市: '三民區' },
        { 高雄市: '三民區' },
        { 高雄市: '大寮區' },
        { 高雄市: '大寮區' },
        { 高雄市: '大寮區' },
        { 高雄市: '大寮區' },
        { 高雄市: '大寮區' },
        { 高雄市: '小港區' },
        { 高雄市: '小港區' },
        { 高雄市: '小港區' },
        { 高雄市: '仁武區' },
        { 高雄市: '仁武區' },
        { 高雄市: '仁武區' },
        { 高雄市: '左營區' },
        { 高雄市: '左營區' },
        { 高雄市: '左營區' },
        { 高雄市: '左營區' },
        { 高雄市: '左營區' },
        { 高雄市: '左營區' },
        { 高雄市: '左營區' },
        { 高雄市: '左營區' },
        { 高雄市: '岡山區' },
        { 高雄市: '岡山區' },
        { 高雄市: '岡山區' },
        { 高雄市: '岡山區' },
        { 高雄市: '林園區' },
        { 高雄市: '林園區' },
        { 高雄市: '前金區' },
        { 高雄市: '前鎮區' },
        { 高雄市: '前鎮區' },
        { 高雄市: '前鎮區' },
        { 高雄市: '前鎮區' },
        { 高雄市: '前鎮區' },
        { 高雄市: '前鎮區' },
        { 高雄市: '前鎮區' },
        { 高雄市: '前鎮區' },
        { 高雄市: '前鎮區' },
        { 高雄市: '苓雅區' },
        { 高雄市: '苓雅區' },
        { 高雄市: '苓雅區' },
        { 高雄市: '苓雅區' },
        { 高雄市: '苓雅區' },
        { 高雄市: '苓雅區' },
        { 高雄市: '苓雅區' },
        { 高雄市: '苓雅區' },
        { 高雄市: '苓雅區' },
        { 高雄市: '楠梓區' },
        { 高雄市: '楠梓區' },
        { 高雄市: '楠梓區' },
        { 高雄市: '楠梓區' },
        { 高雄市: '楠梓區' },
        { 高雄市: '鼓山區' },
        { 高雄市: '鼓山區' },
        { 高雄市: '鼓山區' },
        { 高雄市: '鼓山區' },
        { 高雄市: '鼓山區' },
        { 高雄市: '鼓山區' },
        { 高雄市: '鳳山區' },
        { 高雄市: '鳳山區' },
        { 高雄市: '鳳山區' },
        { 高雄市: '鳳山區' },
        { 高雄市: '鳳山區' },
        { 高雄市: '鳳山區' },
        { 高雄市: '鳳山區' },
        { 高雄市: '鳳山區' },
        { 高雄市: '鳳山區' },
        { 高雄市: '鳳山區' },
        { 屏東縣: '內埔鄉' },
        { 屏東縣: '里港鄉' },
        { 屏東縣: '東港鎮' },
        { 屏東縣: '長治鄉' },
        { 屏東縣: '屏東市' },
        { 屏東縣: '屏東市' },
        { 屏東縣: '屏東市' },
        { 屏東縣: '屏東市' },
        { 屏東縣: '恆春鎮' },
        { 屏東縣: '高樹鄉' },
        { 屏東縣: '新園鄉' },
        { 屏東縣: '萬丹鄉' },
        { 屏東縣: '萬丹鄉' },
        { 屏東縣: '潮州鎮' },
        { 屏東縣: '潮州鎮' },
        { 屏東縣: '鹽埔鄉' },
        { 屏東縣: '鹽埔鄉' },
        { 屏東縣: '鹽埔鄉' },
        { 澎湖縣: '馬公市' },
        { 澎湖縣: '馬公市' },
        { 花蓮縣: '玉里鎮' },
        { 花蓮縣: '玉里鎮' },
        { 花蓮縣: '光復鄉' },
        { 花蓮縣: '吉安鄉' },
        { 花蓮縣: '秀林鄉' },
        { 花蓮縣: '花蓮市' },
        { 花蓮縣: '花蓮市' },
        { 花蓮縣: '新城鄉' },
        { 臺東縣: '東河鄉' },
        { 臺東縣: '金峰鄉' },
        { 臺東縣: '鹿野鄉' },
        { 臺東縣: '綠島鄉' },
        { 臺東縣: '臺東市' },
        { 臺東縣: '臺東市' },
        { 臺北市: '松山區' },
        { 臺北市: '萬華區' },
        { 新北市: '永和區' },
        { 新北市: '永和區' },
        { 桃園市: '八德區' },
        { 桃園市: '大溪區' },
        { 桃園市: '中壢區' },
        { 桃園市: '中壢區' },
        { 桃園市: '中壢區' },
        { 桃園市: '中壢區' },
        { 桃園市: '平鎮區' },
        { 桃園市: '桃園區' },
        { 桃園市: '桃園區' },
        { 桃園市: '桃園區' },
        { 桃園市: '桃園區' },
        { 桃園市: '桃園區' },
        { 桃園市: '桃園區' },
        { 桃園市: '楊梅區' },
        { 桃園市: '龍潭區' },
        { 桃園市: '龍潭區' },
        { 桃園市: '龜山區' },
        { 桃園市: '龜山區' },
        { 桃園市: '觀音區' },
        { 桃園市: '觀音區' },
        { 新竹市: '東區' },
        { 新竹縣: '尖石鄉' },
        { 新竹縣: '竹北市' },
        { 新竹縣: '寶山鄉' },
        { 苗栗縣: '獅潭鄉' },
        { 彰化縣: '彰化市' },
        { 新北市: '板橋區' },
        { 新北市: '新店區' },
        { 新北市: '蘆洲區' },
        { 新北市: '瑞芳區' },
        { 新北市: '五股區' },
        { 新北市: '深坑區' },
        { 新北市: '八里區' },
        { 新北市: '平溪區' },
        { 新北市: '三芝區' },
        { 基隆市: '中正區' },
        { 臺東縣: '臺東市' },
        { 臺東縣: '蘭嶼鄉' },
        { 臺東縣: '延平鄉' },
        { 臺東縣: '卑南鄉' },
        { 臺東縣: '關山鎮' },
        { 臺東縣: '海端鄉' },
        { 臺東縣: '池上鄉' },
        { 臺東縣: '東河鄉' },
        { 臺東縣: '成功鎮' },
        { 臺東縣: '長濱鄉' },
        { 臺東縣: '太麻里' },
        { 臺東縣: '大武鄉' },
        { 臺東縣: '達仁鄉' },
        { 新北市: '永和區' },
        { 新北市: '土城區' },
        { 新北市: '鶯歌區' },
        { 新北市: '淡水區' },
        { 新北市: '泰山區' },
        { 新北市: '林口區' },
        { 新北市: '石門區' },
        { 新北市: '樹林區' },
        { 新北市: '三重區' },
        { 新北市: '三重區' },
        { 新北市: '萬里區' },
        { 新北市: '蘆洲區' },
        { 基隆市: '中正區' },
        { 基隆市: '七堵區' },
        { 基隆市: '仁愛區' },
        { 新北市: '新莊區' },
        { 新北市: '三重區' },
        { 新北市: '三重區' },
        { 新北市: '三重區' },
        { 新北市: '三重區' },
        { 新北市: '三重區' },
        { 新北市: '三重區' },
        { 新北市: '中和區' },
        { 新北市: '中和區' },
        { 新北市: '中和區' },
        { 新北市: '中和區' },
        { 新北市: '中和區' },
        { 新北市: '中和區' },
        { 新北市: '中和區' },
        { 新北市: '中和區' },
        { 基隆市: '中正區' },
        { 基隆市: '仁愛區' },
        { 基隆市: '中正區' },
        { 臺東縣: '臺東市' },
        { 臺東縣: '太麻里' },
        { 臺東縣: '臺東市' },
        { 臺東縣: '臺東市' },
        { 臺東縣: '臺東市' },
        { 臺東縣: '臺東市' },
        { 新北市: '三峽區' },
        { 基隆市: '仁愛區' },
        { 基隆市: '仁愛區' },
        { 新北市: '中和區' },
        { 新北市: '三峽區' },
        { 臺中市: '大里區' },
        { 臺中市: '梧棲區' },
        { 臺中市: '龍井區' },
        { 臺中市: '霧峰區' },
        { 彰化縣: '芳苑鄉' },
        { 南投縣: '南投市' },
        { 臺中市: '西屯區' },
        { 新北市: '三重區' },
        { 新北市: '三重區' },
        { 新北市: '三重區' },
        { 彰化縣: '線西鄉' },
        { 新北市: '中和區' },
        { 新北市: '板橋區' },
        { 新北市: '中和區' },
        { 新北市: '中和區' },
        { 新北市: '新莊區' },
        { 新北市: '永和區' },
        { 新北市: '鶯歌區' },
        { 新北市: '三重區' },
        { 新北市: '三重區' },
        { 新北市: '三重區' },
        { 新北市: '三重區' },
        { 新北市: '新莊區' },
        { 新北市: '樹林區' },
        { 臺北市: '北投區' },
        { 新北市: '三重區' },
        { 新北市: '三重區' },
        { 新北市: '板橋區' },
        { 新北市: '板橋區' },
        { 新北市: '新莊區' },
        { 新北市: '三重區' },
        { 新北市: '三重區' },
        { 新北市: '三重區' },
        { 新北市: '蘆洲區' },
        { 新北市: '蘆洲區' },
        { 新北市: '板橋區' },
        { 新北市: '新莊區' },
        { 新北市: '新莊區' },
        { 新北市: '新莊區' },
        { 臺北市: '內湖區' },
        { 新北市: '蘆洲區' },
        { 新北市: '蘆洲區' },
        { 新北市: '蘆洲區' },
        { 新北市: '蘆洲區' },
        { 新北市: '三重區' },
        { 新北市: '板橋區' },
        { 新北市: '板橋區' },
        { 新北市: '新莊區' },
        { 新北市: '泰山區' },
        { 新北市: '三重區' },
        { 新北市: '三重區' },
        { 新北市: '三重區' },
        { 新北市: '三重區' },
        { 新北市: '中和區' },
        { 新北市: '板橋區' },
        { 新北市: '泰山區' },
        { 新北市: '永和區' },
        { 新北市: '永和區' },
        { 新北市: '樹林區' },
        { 新北市: '樹林區' },
        { 新北市: '蘆洲區' },
        { 新北市: '蘆洲區' },
        { 新北市: '蘆洲區' },
        { 新北市: '蘆洲區' },
        { 新北市: '新店區' },
        { 臺北市: '內湖區' },
        { 臺北市: '中山區' },
        { 臺北市: '大安區' },
        { 臺北市: '信義區' },
        { 宜蘭縣: '宜蘭市' },
        { 臺中市: '北屯區' },
        { 臺中市: '大甲區' },
        { 臺中市: '大甲區' },
        { 臺中市: '大甲區' },
        { 臺中市: '南屯區' },
        { 雲林縣: '虎尾鎮' },
        { 嘉義市: '東區' },
        { 嘉義市: '西區' },
        { 嘉義市: '東區' },
        { 嘉義市: '西區' },
        { 嘉義市: '東區' },
        { 南投縣: '埔里鎮' },
        { 花蓮縣: '吉安鄉' },
        { 花蓮縣: '壽豐鄉' },
        { 花蓮縣: '花蓮市' },
        { 花蓮縣: '花蓮市' },
        { 花蓮縣: '吉安鄉' },
        { 花蓮縣: '吉安鄉' },
        { 花蓮縣: '花蓮市' },
        { 花蓮縣: '花蓮市' },
        { 花蓮縣: '花蓮市' },
        { 花蓮縣: '花蓮市' },
        { 花蓮縣: '吉安鄉' },
        { 花蓮縣: '花蓮市' },
        { 花蓮縣: '花蓮市' },
        { 花蓮縣: '新城鄉' },
        { 花蓮縣: '花蓮市' },
        { 花蓮縣: '鳳林鎮' },
        { 花蓮縣: '富里鄉' },
        { 花蓮縣: '吉安鄉' },
        { 臺東縣: '臺東市' },
        { 臺東縣: '成功鎮' },
        { 屏東縣: '屏東市' },
        { 南投縣: '南投市' }
      ]
    }
  },

  methods: {
    getPharmacyName () {
      let countyName = []
      this.countyPharmacyNameNoSortData.forEach(allCounty => {
        countyName = Object.keys(allCounty)
        if (this.countyPharmacyNameData[countyName[0]] === undefined) {
          this.countyPharmacyNameData[countyName[0]] = []
        }
        if (this.countyPharmacyNameData[countyName[0]] !== allCounty[countyName]) {
          this.countyPharmacyNameData[countyName[0]].push(allCounty[countyName])
        }
        //* 將重複的地區名稱篩選
        this.countyPharmacyNameData[countyName[0]] = this.countyPharmacyNameData[countyName[0]].filter(function (element, index, arr) {
          return arr.indexOf(element) === index //* indexOf 只會找第一個相符的，所以就能做到重複的被篩選的效果
        })
      })
    },
    searchAreaPharmacy (active, e) {
      this.isLoading = true
      this.rapidTestData = []
      const target = e.target.value
      let searchArea = ''
      if (active === 'county') {
        searchArea = target
        this.countyName = target
        this.areaName = this.countyPharmacyNameData[target]
        document.querySelector('.areaSelect').value = '請選擇地區'
        this.searchText = ''
      } else if (active === 'area') {
        searchArea = `${this.countyName}${target}`
        this.searchText = ''
      } else if (active === 'search') {
        //* 如果使用者輸入"台"，例：台北、台中、台南 就轉成"臺"
        if (this.searchText.indexOf('台') >= 0) {
          const changeTextIndex = this.searchText.indexOf('台')
          const text = [...this.searchText.split('')]
          text.splice(changeTextIndex, 1, '臺')
          this.searchText = text.join('')
        }
        searchArea = this.searchText
        this.$refs.countySelector.value = '請選擇縣市'
        this.$refs.areaSelector.value = '請選擇地區'
        this.areaName = []
      }
      this.rapidTestTempData.forEach(item => {
        if (item[2]?.includes(searchArea) || item[1]?.includes(searchArea)) {
          this.rapidTestData.push(item)
        }
      })
      this.isLoading = false
    },
    getRapidTestData (active, e) { //* 每次搜尋都戳 API ，確保是最新資訊
      this.isLoading = true
      this.$http.get(this.apiPath)
        .then(res => {
          this.isLoading = false
          this.rapidTestTempData = [] //* 初始化 不然 push 會一直疊加
          const data = res.data.split('\r\n')
          data.forEach(item => {
            this.rapidTestTempData.push(item.split(','))
          })
          if (this.areaName.length === 0) this.getPharmacyName()
          this.searchAreaPharmacy(active, e)
        })
        .catch(() => {
          this.isLoading = false
        })
    },
    getToday () {
      const date = new Date()
      if (date.getDay() % 2 === 0) {
        this.canBuyRapidTestId = '雙數'
      } else {
        this.canBuyRapidTestId = '單數'
      }
      if (date.getDay() === 7) {
        this.canBuyRapidTestId = '單數、雙數'
      }
    }
  },

  mounted () {
    this.apiPath = process.env.VUE_APP_RAPIDTEST_API
    this.getToday()
    this.getRapidTestData()

    window.addEventListener('scroll', () => {
      const scrollY = window.scrollY
      if (scrollY >= 1000) {
        this.topScrollBtnHide = false
      } else if (scrollY <= 300) {
        this.topScrollBtnHide = true
      }
    })
  }

}
</script>
